<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>å•ç­”éŠæˆ²ç³»çµ±</title>
<link rel="icon" href="img/icon-180.png" type="image/png" />
<style>
:root {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Noto Sans CJK TC', 'Helvetica Neue', Arial;
  --main-color: #2b7a78;
  --main-hover: #3a9996;
  --bg-color: #faf6ec;
  --card-bg: #fff;
  --shadow-color: rgba(0,0,0,0.08);
  --danger-color: #e63946;
}
body {
  margin: 0;
  background: var(--bg-color);
  color: #222;
  display: flex;
  justify-content: center;
  align-items: flex-start;
  min-height: 100vh;
  padding-top: 40px;
}
.card {
  background: var(--card-bg);
  padding: 20px;
  border-radius: 12px;
  box-shadow: 0 6px 22px var(--shadow-color);
  width: 360px;
  max-width: 95vw;
  text-align: center;
  box-sizing: border-box;
}
h1, h2, h3 { margin:0 0 16px; font-weight:600; }
h1{ font-size:20px; }
.menu-grid { display:flex; flex-direction:column; gap:12px; }
.menu-grid button {
  height:60px;
  font-size:clamp(1rem,2vw,1.5rem);
  border-radius:8px;
  border:none;
  background: var(--main-color);
  color:#fff;
  cursor:pointer;
  transition: background-color 0.2s ease;
}
.menu-grid button:hover:not(:disabled){ background: #4CAF50; } /* æ·¡ç¶ è‰² */
.menu-grid button:disabled{ background:#99b3b2; cursor:not-allowed; }

.section { display:none; text-align:left; }
.section.active{ display:block; }

.backBtn {
  margin-top:20px;
  padding:12px 0;
  width:100%;
  border-radius:8px;
  border:none;
  background: #2b7a78;
  color:#fff;
  cursor:pointer;
  transition: background-color 0.2s ease;
}
.backBtn:hover{ background:#4CAF50; }
input, select, textarea { font-size:1em; width:100%; padding:6px; margin:4px 0 12px; box-sizing:border-box; }
table{ width:100%; border-collapse:collapse; }
table, th, td { border:1px solid #ccc; }
th, td { padding:6px; text-align:center; }

#questionManage div.flex-row{ display:flex; gap:6px; flex-wrap:nowrap; align-items:center; margin-bottom:12px; }
#questionManage div.flex-row button, #questionManage div.flex-row input[type=file]{ margin-bottom:0; flex:1; }

.optionBtn, #confirmAnswerBtn, #startQuizBtn{
  display:block;
  width:100%;
  padding:12px 0;
  margin-bottom:6px;
  border-radius:8px;
  border:none;
  background: var(--main-color);
  color:#fff;
  cursor:pointer;
  font-size:1rem;
}
.optionBtn:disabled, #confirmAnswerBtn:disabled, #startQuizBtn:disabled{
  background:#99b3b2;
  cursor:not-allowed;
}
#confirmAnswerBtn{ background: var(--danger-color); }
#confirmAnswerBtn:disabled{ background:#f0a6aa; }
#startQuizBtn{ background: var(--danger-color); }
</style>
</head>
<body>
<div class="card">
  <!-- ä¸»é¸å–® -->
  <div id="menu" class="section active">
    <h1>å•ç­”éŠæˆ²ç³»çµ±</h1>
    <div class="menu-grid">
      <button id="goToQuiz">ğŸ“ å•ç­”éŠæˆ²</button>
      <button id="goToQuestionManage">ğŸ“š é¡Œç›®ç®¡ç†</button>
      <button id="goToRanking">ğŸ† æ’è¡Œæ¦œ</button>
      <button id="goToHelp">ğŸ“– ä½¿ç”¨èªªæ˜</button>
      <button id="goToHelpAdd">ğŸ“± åŠ å…¥æ‰‹æ©Ÿä¸»ç•«é¢èªªæ˜</button>
    </div>
  </div>

  <!-- å•ç­”éŠæˆ² -->
  <div id="quiz" class="section">
    <h1>å•ç­”éŠæˆ²</h1>
    <div id="playerSetup">
      <label>ç©å®¶åç¨±ï¼š<input type="text" id="playerName" placeholder="è¼¸å…¥ä½ çš„åç¨±" /></label>
      <button id="startQuizBtn">é–‹å§‹ç­”é¡Œ</button>
    </div>
    <div id="quizArea" style="display:none;">
      <div id="questionText"></div>
      <div id="optionsContainer"></div>
      <button id="confirmAnswerBtn" disabled>ç¢ºèªç­”æ¡ˆ</button>
    </div>
    <div id="quizResult" style="display:none;"></div>
    <button class="backBtn" data-back="menu">è¿”å›ä¸»é¸å–®</button>
  </div>

  <!-- é¡Œç›®ç®¡ç† -->
  <div id="questionManage" class="section">
    <h1>é¡Œç›®ç®¡ç†ï¼ˆç®¡ç†å“¡ï¼‰</h1>
    <div id="adminLogin">
      <label>ç®¡ç†è€…å¯†ç¢¼ï¼š<input type="password" id="adminPassword" /></label>
      <button id="loginAdminBtn">ç™»å…¥ç®¡ç†</button>
    </div>
    <div id="adminPanel" style="display:none;">
      <label>é¡Œç›®ï¼š<input type="text" id="newQuestion" /></label>
      <label>é¸é … Aï¼š<input type="text" id="optionA" /></label>
      <label>é¸é … Bï¼š<input type="text" id="optionB" /></label>
      <label>é¸é … Cï¼š<input type="text" id="optionC" /></label>
      <label>é¸é … Dï¼š<input type="text" id="optionD" /></label>
      <label>æ­£ç¢ºç­”æ¡ˆï¼ˆA-Dï¼‰ï¼š<input type="text" id="correctOption" maxlength="1" /></label>

      <div id="questionActions" style="margin-bottom:12px;">
        <button id="addQuestionBtn">æ–°å¢é¡Œç›®</button>
      </div>
      <div class="flex-row">
        <input type="file" id="importCSV" accept=".csv" />
        <button id="importBtn">åŒ¯å…¥ CSV</button>
        <button id="exportCSVBtn">åŒ¯å‡º CSV</button>
      </div>

      <table id="questionTable">
        <thead><tr><th>é¡Œç›®</th><th>A</th><th>B</th><th>C</th><th>D</th><th>æ­£ç¢ºç­”æ¡ˆ</th><th>åˆªé™¤</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>
    <button class="backBtn" data-back="menu">è¿”å›ä¸»é¸å–®</button>
  </div>

  <!-- æ’è¡Œæ¦œ -->
  <div id="ranking" class="section">
    <h1>æ’è¡Œæ¦œ</h1>
    <table id="rankingTable">
      <thead><tr><th>ç©å®¶åç¨±</th><th>åˆ†æ•¸</th><th>åˆªé™¤</th></tr></thead>
      <tbody></tbody>
    </table>
    <button class="backBtn" data-back="menu">è¿”å›ä¸»é¸å–®</button>
  </div>

  <!-- ä½¿ç”¨èªªæ˜ -->
  <div id="help" class="section">
    <h2>ğŸ“– ä½¿ç”¨èªªæ˜</h2>
    <p>é€™æ˜¯éŠæˆ²çš„åŸºæœ¬ä½¿ç”¨èªªæ˜ï¼šé»é¸å•ç­”éŠæˆ²é–‹å§‹ç­”é¡Œï¼Œè¼¸å…¥ç©å®¶åç¨±å³å¯é–‹å§‹ã€‚é¡Œç›®ç®¡ç†èˆ‡æ’è¡Œæ¦œæœ‰ç®¡ç†å“¡æ¬Šé™é™åˆ¶ã€‚å®Œæˆç­”é¡Œå¾Œå¯æŸ¥çœ‹åˆ†æ•¸èˆ‡ç­”æ¡ˆã€‚</p>
    <button class="backBtn" data-back="menu">è¿”å›ä¸»é¸å–®</button>
  </div>

  <!-- åŠ å…¥æ‰‹æ©Ÿä¸»ç•«é¢èªªæ˜ -->
  <div id="helpAdd" class="section">
    <h2>ğŸ“± åŠ å…¥æ‰‹æ©Ÿä¸»ç•«é¢èªªæ˜</h2>
    <h3>iOSï¼ˆSafariï¼‰</h3>
    <ol>
      <li>åœ¨ Safari é–‹å•Ÿæ­¤ç¶²é </li>
      <li>é»é¸åº•éƒ¨ã€Œåˆ†äº«ã€æŒ‰éˆ•</li>
      <li>é¸æ“‡ã€ŒåŠ å…¥ä¸»ç•«é¢ã€</li>
      <li>ç¢ºèªåç¨±å¾Œé»é¸ã€ŒåŠ å…¥ã€</li>
    </ol>
    <h3>Androidï¼ˆChromeï¼‰</h3>
    <ol>
      <li>åœ¨ Chrome é–‹å•Ÿæ­¤ç¶²é </li>
      <li>é»é¸å³ä¸Šè§’ã€Œâ‹®ã€é¸å–®</li>
      <li>é¸æ“‡ã€ŒåŠ åˆ°ä¸»ç•«é¢ã€æˆ–ã€Œå®‰è£æ‡‰ç”¨ç¨‹å¼ã€</li>
      <li>ç¢ºèªåç¨±å¾Œé»é¸ã€ŒåŠ å…¥ã€</li>
    </ol>
    <button class="backBtn" data-back="menu">è¿”å›ä¸»é¸å–®</button>
  </div>
</div>

<!-- æ’è¡Œæ¦œåˆªé™¤å¯†ç¢¼ Modal -->
<div id="rankingPassModal" style="display:none; position:fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.5); justify-content:center; align-items:center;">
  <div style="background:#fff; padding:20px; border-radius:8px; width:300px;">
    <p>è¼¸å…¥ç®¡ç†è€…å¯†ç¢¼åˆªé™¤ï¼š</p>
    <input type="password" id="rankingPassInput" style="width:100%; margin-bottom:12px;" />
    <div style="display:flex; justify-content:space-between;">
      <button id="rankingPassConfirm">ç¢ºèª</button>
      <button id="rankingPassCancel">å–æ¶ˆ</button>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const sections = { menu, quiz, questionManage, ranking, help, helpAdd };
  const showSection = name => {
    Object.values(sections).forEach(s => s.classList.remove('active'));
    sections[name].classList.add('active');
    if(name==='menu'){
      quizArea.style.display='none';
      playerSetup.style.display='block';
      quizResult.style.display='none';
      currentQuestionIndex=0;
      playerAnswers=[];
      selectedAnswer=null;
      playerNameInput.value='';
    }
    if(name==='ranking'){
      rankingPassVerified=false;
    }
  };
  goToQuiz.onclick = ()=>showSection('quiz');
  goToQuestionManage.onclick = ()=>showSection('questionManage');
  goToRanking.onclick = ()=>showSection('ranking');
  goToHelp.onclick = ()=>showSection('help');
  goToHelpAdd.onclick = ()=>showSection('helpAdd');
  document.querySelectorAll('.backBtn').forEach(btn=>btn.onclick=e=>showSection(e.target.dataset.back));

  // -------------------------- å•ç­”éŠæˆ²
  let questions = JSON.parse(localStorage.getItem('questions')||'[]');
  let currentQuestionIndex=0;
  let playerAnswers=[];
  let playerName='';
  let selectedAnswer=null;
  const playerNameInput=document.getElementById('playerName');
  const quizArea=document.getElementById('quizArea');
  const questionText=document.getElementById('questionText');
  const optionsContainer=document.getElementById('optionsContainer');
  const quizResult=document.getElementById('quizResult');
  const startQuizBtn=document.getElementById('startQuizBtn');
  const confirmAnswerBtn=document.getElementById('confirmAnswerBtn');
  const playerSetup=document.getElementById('playerSetup');

  const MAX_PLAYERS=50;
  const MAX_QUESTIONS=10;

  function loadQuestion(){
    const q = questions[currentQuestionIndex];
    questionText.textContent = `${currentQuestionIndex+1}. ${q.question}`;
    optionsContainer.innerHTML='';
    selectedAnswer=null;
    confirmAnswerBtn.disabled=true;
    ['A','B','C','D'].forEach(k=>{
      if(q[k]){
        const btn=document.createElement('button');
        btn.textContent=`${k}: ${q[k]}`;
        btn.className='optionBtn';
        btn.style.backgroundColor = '#2b7a78';
        btn.onclick=()=>{
          selectedAnswer=k;
          confirmAnswerBtn.disabled=false;
          document.querySelectorAll('.optionBtn').forEach(b=>{
            if(b!==btn) b.style.backgroundColor='#2b7a78';
            else b.style.backgroundColor='red';
          });
        };
        optionsContainer.appendChild(btn);
      }
    });
  }

  confirmAnswerBtn.onclick=()=>{
    playerAnswers[currentQuestionIndex]=selectedAnswer;
    if(currentQuestionIndex+1<questions.length){
      currentQuestionIndex++;
      loadQuestion();
    }else showQuizResult();
  }

  startQuizBtn.onclick=startQuiz;
  playerNameInput.addEventListener('keypress', e=>{ if(e.key==='Enter') startQuiz(); });

  function startQuiz(){
    const rankingData = JSON.parse(localStorage.getItem('ranking')||'[]');
    if(rankingData.length>=MAX_PLAYERS){ alert(`ç©å®¶æ•¸å·²é”ä¸Šé™ ${MAX_PLAYERS}`); return; }
    const playerNameSet = new Set(rankingData.map(p=>p.name));
    playerName=playerNameInput.value.trim();
    if(!playerName){ alert('è«‹è¼¸å…¥ç©å®¶åç¨±'); return; }
    if(playerNameSet.has(playerName)){ alert('ç©å®¶åç¨±å·²å­˜åœ¨ï¼Œè«‹è¼¸å…¥æ–°åç¨±'); return; }
    if(questions.length===0){ alert('é¡Œåº«ç‚ºç©º'); return; }
    currentQuestionIndex=0;
    playerAnswers=[];
    playerSetup.style.display='none';
    quizArea.style.display='block';
    quizResult.style.display='none';
    loadQuestion();
  }

  function showQuizResult(){
    quizArea.style.display='none';
    quizResult.style.display='block';
    let score=0;
    let html=`<h3>${playerName} çš„ç­”é¡Œçµæœ</h3><ol>`;
    questions.forEach((q,i)=>{
      const correct=q.correct;
      const player=playerAnswers[i]||'-';
      if(player===correct) score++;
      html+=`<li>${q.question}<br>ä½ çš„é¸æ“‡ï¼š${player} | æ­£ç¢ºç­”æ¡ˆï¼š${correct}</li>`;
    });
    html+=`</ol><p>ç¸½åˆ†ï¼š${score}</p>`;
    quizResult.innerHTML=html;

    const rankingData = JSON.parse(localStorage.getItem('ranking')||'[]');
    rankingData.push({ name: playerName, score });
    localStorage.setItem('ranking', JSON.stringify(rankingData));
    updateRankingTable();
  }

  // -------------------------- é¡Œç›®ç®¡ç†
  const adminPass='admin123';
  const loginAdminBtn=document.getElementById('loginAdminBtn');
  const adminPassword=document.getElementById('adminPassword');
  const adminPanel=document.getElementById('adminPanel');
  const adminLogin=document.getElementById('adminLogin');
  const addQuestionBtn=document.getElementById('addQuestionBtn');
  const newQuestion=document.getElementById('newQuestion');
  const optionA=document.getElementById('optionA');
  const optionB=document.getElementById('optionB');
  const optionC=document.getElementById('optionC');
  const optionD=document.getElementById('optionD');
  const correctOption=document.getElementById('correctOption');
  const questionTable=document.getElementById('questionTable');
  const importCSV=document.getElementById('importCSV');
  const importBtn=document.getElementById('importBtn');
  const exportCSVBtn=document.getElementById('exportCSVBtn');

  loginAdminBtn.onclick=loginAdmin;
  adminPassword.addEventListener('keypress', e=>{ if(e.key==='Enter') loginAdmin(); });

  function loginAdmin(){
    if(adminPassword.value===adminPass){
      adminPanel.style.display='block';
      adminLogin.style.display='none';
    }else alert('å¯†ç¢¼éŒ¯èª¤');
  }

  function updateQuestionTable(){
    const tbody=questionTable.querySelector('tbody');
    tbody.innerHTML='';
    questions.forEach((q,i)=>{
      const tr=document.createElement('tr');
      ['question','A','B','C','D','correct'].forEach(k=>{
        const td=document.createElement('td');
        td.textContent=q[k]||'';
        tr.appendChild(td);
      });
      const delTd=document.createElement('td');
      const delBtn=document.createElement('button');
      delBtn.textContent='åˆªé™¤';
      delBtn.onclick=()=>{ questions.splice(i,1); saveQuestions(); updateQuestionTable(); };
      delTd.appendChild(delBtn);
      tr.appendChild(delTd);
      tbody.appendChild(tr);
    });
  }

  addQuestionBtn.onclick=()=>{
    if(questions.length>=MAX_QUESTIONS){ alert(`é¡Œç›®æ•¸å·²é”ä¸Šé™ ${MAX_QUESTIONS}`); return; }
    if(!newQuestion.value.trim() || !optionA.value.trim() || !optionB.value.trim()){
      alert('é¡Œç›®ã€é¸é …Aã€é¸é …Bç‚ºå¿…å¡«æ¬„ä½'); return;
    }
    const q={ question:newQuestion.value.trim(),
              A:optionA.value.trim(),
              B:optionB.value.trim(),
              C:optionC.value.trim(),
              D:optionD.value.trim(),
              correct:correctOption.value.trim().toUpperCase() };
    questions.push(q); saveQuestions(); updateQuestionTable();
  }

  function saveQuestions(){ localStorage.setItem('questions', JSON.stringify(questions)); }

  importBtn.onclick=()=>{
    const file = importCSV.files[0];
    if(!file) return;
    const reader = new FileReader();
    reader.onload=e=>{
      const lines = e.target.result.split('\n');
      lines.forEach(line=>{
        const [q,a,b,c,d,correct]=line.split(',');
        if(q && a && b && questions.length<MAX_QUESTIONS){
          questions.push({question:q,A:a,B:b,C:c||'',D:d||'',correct:correct||''});
        }
      });
      saveQuestions(); updateQuestionTable();
    };
    reader.readAsText(file, 'UTF-8');
  };

  exportCSVBtn.onclick=()=>{
    let csv='question,A,B,C,D,correct\n';
    questions.forEach(q=>{ csv+=`${q.question},${q.A},${q.B},${q.C},${q.D},${q.correct}\n`; });
    const blob=new Blob([csv],{type:'text/csv'});
    const a=document.createElement('a'); a.href=URL.createObjectURL(blob);
    a.download='questions.csv'; a.click(); URL.revokeObjectURL(a.href);
  };

  updateQuestionTable();

  // -------------------------- æ’è¡Œæ¦œ
  const rankingTableBody=document.querySelector('#rankingTable tbody');
  let rankingPassVerified=false;
  let rankingDelIndex=null;
  const rankingPassModal=document.getElementById('rankingPassModal');
  const rankingPassInput=document.getElementById('rankingPassInput');
  const rankingPassConfirm=document.getElementById('rankingPassConfirm');
  const rankingPassCancel=document.getElementById('rankingPassCancel');

  function updateRankingTable(){
    const data = JSON.parse(localStorage.getItem('ranking')||'[]');
    rankingTableBody.innerHTML='';
    data.forEach((r,i)=>{
      const tr=document.createElement('tr');
      const nameTd=document.createElement('td'); nameTd.textContent=r.name; tr.appendChild(nameTd);
      const scoreTd=document.createElement('td'); scoreTd.textContent=r.score; tr.appendChild(scoreTd);
      const delTd=document.createElement('td');
      const delBtn=document.createElement('button'); delBtn.textContent='åˆªé™¤';
      delBtn.onclick=()=>{
        rankingDelIndex=i;
        rankingPassInput.value=''; rankingPassModal.style.display='flex';
      };
      delTd.appendChild(delBtn); tr.appendChild(delTd);
      rankingTableBody.appendChild(tr);
    });
  }

  rankingPassCancel.onclick=()=>{ rankingPassModal.style.display='none'; };
  rankingPassConfirm.onclick=()=>{
    if(rankingPassInput.value===adminPass){
      const data=JSON.parse(localStorage.getItem('ranking')||'[]');
      data.splice(rankingDelIndex,1);
      localStorage.setItem('ranking', JSON.stringify(data));
      rankingDelIndex=null; rankingPassModal.style.display='none';
      updateRankingTable();
    }else alert('å¯†ç¢¼éŒ¯èª¤');
  };

  updateRankingTable();

});
</script>
</body>
</html>
